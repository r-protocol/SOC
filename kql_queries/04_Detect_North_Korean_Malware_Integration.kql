// Detect North Korean Malware Integration
// Type: Behavioral_Hunt
// Description: Identifies suspicious process creation and file operations indicative of the North Korean hackers' integration of BeaverTail and OtterCookie malware functionalities.
// MITRE ATT&CK: T1059, T1055

DeviceProcessEvents
| where ProcessCommandLine contains 'North Korean'
| extend ParentProc = extract('ParentImage', 1, ProcessCommandLine, typeof(string))
| where isnotnull(ParentProc)
| join kind=inner (DeviceProcessEvents | where ProcessName in ('beaveltail.js', 'ottercookie.js')) on $left.ProcessId == $right.ProcessId
| project Timestamp, DeviceName, ParentProc, ProcessCommandLine
