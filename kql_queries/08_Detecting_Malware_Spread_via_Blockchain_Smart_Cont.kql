// Detecting Malware Spread via Blockchain Smart Contracts
// Type: Behavioral_Hunt
// Description: This query detects the use of compromised WordPress sites to spread malware through blockchain smart contracts by analyzing suspicious process executions, file operations, and potential registry modifications.
// MITRE ATT&CK: T1059, T1055

DeviceProcessEvents
| where ProcessCommandLine contains 'wp-admin' or ProcessCommandLine contains 'blockchain.eth'
| summarize CountOfProcesses = count() by Account, CommandLine
| where CountOfProcesses > 1
| join kind=left ( DeviceFileEvents
| where FileName contains '.exe' or FileName contains '.dll'
| project Timestamp, ProcessId, FilePath)
on Account
| where isnotnull(CommandLine) and CommandLine !contains 'powershell.exe' and CommandLine !contains 'cmd.exe'
| summarize CountOfFiles = count() by Account, CommandLine
